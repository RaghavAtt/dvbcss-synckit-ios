<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CIIProtocolClient  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    <!-- new top header bar across all sub-frameworks --> <div style="margin:0; width: 100%; padding: 8px 0 8px 8px; background-color: #005" class="header">
    <a href="../../../../../../index.html" style="margin: 0; padding: 0 8px; font-weight: bold; color:white;">
        dvbcss-synckit-ios
    </a>
</div> <!-- shuffle the "view on github" link up to be on the new top header bar --> <style type="text/css">
    header .header-col.header-col--secondary a.header-link {
        position: relative;
        top: -39px;
    }
</style>

  </head>
  <body>


    <a title="CIIProtocolClient  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          CIIProtocolClient Docs
        </a>
        
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/bbc/dvbcss-synckit-ios">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">CIIProtocolClient Reference</a>
      <img class="carat" src="img/carat.png" />
      CIIProtocolClient  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CII.html">CII</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CIIClient.html">CIIClient</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TimelineOption.html">TimelineOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TimelineProperties.html">TimelineProperties</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@CIIProtocolClientVersionNumber">CIIProtocolClientVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@CIIProtocolClientVersionString">CIIProtocolClientVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kCIIChangeStatusMask">kCIIChangeStatusMask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kCIIConnectionFailure">kCIIConnectionFailure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kCIIDidChange">kCIIDidChange</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kMRSUrl">kMRSUrl</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kaccuracy">kaccuracy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kcontentId">kcontentId</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kcontentIdStatus">kcontentIdStatus</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kpresentationStatus">kpresentationStatus</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kprotocolVersion">kprotocolVersion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ktimelineProperties">ktimelineProperties</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ktimelineSelector">ktimelineSelector</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ktimelines">ktimelines</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ktsUrl">ktsUrl</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kunitsPerSecond">kunitsPerSecond</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kunitsPerTick">kunitsPerTick</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kwcUrl">kwcUrl</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CIIChangeStatus.html">CIIChangeStatus</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <a href='#small-dvbcss-synckit-ios-small-br-ciiprotocolclient-framework' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='small-dvbcss-synckit-ios-small-br-ciiprotocolclient-framework'><small>dvbcss-synckit-ios</small><br/>CIIProtocolClient Framework</h1>

<ul>
<li><strong><a href="#dependencies">Dependencies</a></strong></li>
<li><strong><a href="#how-to-use">How to use</a></strong></li>
<li><strong><a href="#run-the-example-app">Run the example app</a></strong></li>
</ul>

<p>This framework provides a client component for the CSS-CII protocol. A TV that implements 
<a href="https://www.dvb.org/standards/dvb_css">DVB CSS</a> or 
<a href="http://hbbtv.org/resource-library/#specifications">HbbTV 2</a> specifications
contains a server for this protocol.</p>

<p>A companion screen application should connect to a TV using this protocol to receive
receive content identifiers and other information such as the URL of other
DVB-CSS protocol endpoints (for the CSS-WC and CSS-TS protocols)</p>
<a href='#dependencies' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='dependencies'>Dependencies</h4>

<p>The CIIProtocolClient library requires the following dynamic libraries (iOS frameworks) (found in SyncKit):</p>

<ul>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../SyncKitConfiguration">SyncKitConfiguration</a></li>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../SimpleLogger">SimpleLogger</a></li>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../SocketRocket">SocketRocket</a> - the SocketRocket web socket library</li>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../SyncKitCollections">SyncKitCollections</a></li>
</ul>
<a href='#how-to-use' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='how-to-use'>How to use</h2>
<a href='#1-add-the-framework-and-its-dependencies-to-your-project' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='1-add-the-framework-and-its-dependencies-to-your-project'>1. Add the framework and its dependencies to your project</h4>

<p>A Cocoa Pod version of this library is not currently available. To use this library, you must add it and its dependencies to your project.</p>

<p>You will need the following projects from this repository:</p>

<ul>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../SyncKitConfiguration">SyncKitConfiguration</a></li>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../SimpleLogger">SimpleLogger</a></li>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../SocketRocket">SocketRocket</a></li>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../SyncKitCollections">SyncKitCollections</a></li>
<li><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/.">CIIProtocolClient</a></li>
</ul>

<p>Either include them in your workspace and build them; or build them in this repository&rsquo;s <a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/../synckit.xcworkspace">synckit.xcworkspace</a></p>

<p>Then add them under <em>Linked Frameworks and libraries</em> in your project&rsquo;s target configuration:</p>

<ul>
<li>SyncKitConfiguration.framework</li>
<li>SimpleLogger.framework</li>
<li>SocketRocketiOS.framework</li>
<li>SyncKitCollections.framework</li>
<li>CIIProtocolClient.framework</li>
</ul>

<p>If you have two XCode instances running you can drag and drop the framework files from their respective project in SyncKit to your own project.</p>
<a href='#2-import-the-header-files' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='2-import-the-header-files'>2. Import the header files</h4>

<p>Import this header file in your source file:</p>
<pre class="highlight plaintext"><code>
  #import &lt;CIIProtocolClient/CIIProtocolClient.h&gt;

</code></pre>
<a href='#3-create-and-configure-a-ciiprotocolclient-object' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='3-create-and-configure-a-ciiprotocolclient-object'>3. Create and configure a CIIProtocolClient object</h4>

<p>When a TV is discovered using the DIALDeviceDiscovery component, the CSS-CII URL reported in the <code>HbbTV_InterDevSyncURL</code> property of a DIALDevice object.
Use this to initialise a protocol client i.e. a <a href="">CIIClient</a> instance.</p>
<pre class="highlight plaintext"><code>  NSString* const kHbbTV_InterDevSyncURL = @"ws://192.168.0.7:7681/cii";

  CIIClient cssCIIClient = [[CIIClient alloc] initWithCIIURL:kHbbTV_InterDevSyncURL];

  if (cssCIIClient)
      [cssCIIClient start];

</code></pre>
<a href='#4-register-for-notifications-about-new-cii-received-or-css-cii-websocket-connection-failure' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='4-register-for-notifications-about-new-cii-received-or-css-cii-websocket-connection-failure'>4. Register for notifications about new CII received or CSS-CII WebSocket connection failure</h4>
<pre class="highlight plaintext"><code>
// --- register for CIIProtocolClient notifications ---
  [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(handleCIINotifications:) name:kCIIConnectionFailure object:nil];

  [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(handleCIINotifications:) name:kCIIDidChange object:nil];



</code></pre>
<a href='#5-handle-notifications-about-cii-changes-or-connection-failures' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='5-handle-notifications-about-cii-changes-or-connection-failures'>5. Handle notifications about CII changes or connection failures</h4>

<p>A change in a received CII is indicated by the appropriate bit being set in a bitmask.  To determine
which fields have changed in a new CII object, use the CIIChangeStatus bitmask in the notification handler routine.</p>
<pre class="highlight plaintext"><code>- (void) handleCIINotifications:(NSNotification*) notification
{
    NSUInteger ciiChangeStatus=0;

    // --- 2. Handle new CII and start WallClock synchronisation ----

    if  ([[notification name] caseInsensitiveCompare:kCIIDidChange] == 0) {

        id temp = [[notification userInfo] objectForKey:kCIIDidChange];

        NSNumber *status = [[notification userInfo] objectForKey:kCIIChangeStatusMask];

        if (status) {
            ciiChangeStatus = [status unsignedIntegerValue];
        }


        if ((ciiChangeStatus &amp; NewCIIReceived) !=0)
        {
            NSLog(@"CSSynchroniser: Received New CII notification ... ");


            if ([temp isKindOfClass:[CII class]])
            {
                currentCII = temp;
            }
        }

        if (ciiChangeStatus  &amp; ContentIdChanged) {

            if ([temp isKindOfClass:[CII class]])
            {
                currentCII = temp;
            }
            // TODO: Handle ContentId change

            // content Id has changed.

            // ...

        }
    }

</code></pre>
<a href='#run-the-example-app' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='run-the-example-app'>Run the example app</h2>

<p>A demo app called <a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/CIIProtocolClient/CIIProtocolClientDemoApp/">CIIProtocolClientDemoApp</a> is included with this framework. To run the demo,open the CIIProtocolClient project in XCode. Choose the CIIProtocolClientDemoApp target, build it and deploy the app on your iOS device or run it in the simulator.</p>

<p>The CSS-CII URL is hardcoded in <code>ViewController.m</code>:</p>
<pre class="highlight plaintext"><code>NSString* const kHbbTV_InterDevSyncURL = @"ws://192.168.0.7:7681/cii";
</code></pre>

<p>Replace the URL with your own CII server instance URL</p>

<p>If you don&rsquo;t have a suitable TV, you can use the CSS-CII example server in <a href="https://github.com/bbc/pydvbcss">pydvbcss</a>:</p>
<pre class="highlight plaintext"><code>$ git clone https://github.com/bbc/pydvbcss.git
$ cd examples
$ python CIIServer.py
</code></pre>

<p>The server listens on 127.0.0.1 on port 7681 and accepts WebSocket connections to <em>ws://ip-address:port-number/cii</em>.</p>
<a href='#licence' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='licence'>Licence</h2>

<p>The CIIProtocolClient iOS Framework is developed by BBC R&amp;D and distributed under the Apache License, <a href="http://www.apache.org/licenses/LICENSE-2.0">Version 2.0</a>.</p>

<p>© Copyright 2016 BBC R&amp;D. All Rights Reserved</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; British Broadcasting Corporation, under <a class="link" href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="external">Apache 2.0 open source licence</a></p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.7.2</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
