<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ClockTimelines  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    <!-- new top header bar across all sub-frameworks --> <div style="margin:0; width: 100%; padding: 8px 0 8px 8px; background-color: #005" class="header">
    <a href="../index.html" style="margin: 0; padding: 0 8px; font-weight: bold; color:white;">
        dvbcss-synckit-ios
    </a>
</div> <!-- shuffle the "view on github" link up to be on the new top header bar --> <style type="text/css">
    header .header-col.header-col--secondary a.header-link {
        position: relative;
        top: -39px;
    }
</style>

  </head>
  <body>


    <a title="ClockTimelines  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          ClockTimelines Docs
        </a>
        
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/bbc/dvbcss-synckit-ios">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">ClockTimelines Reference</a>
      <img class="carat" src="img/carat.png" />
      ClockTimelines  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ClockBase.html">ClockBase</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CorrelatedClock.html">CorrelatedClock</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CorrelationFactory.html">CorrelationFactory</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MonotonicTime.html">MonotonicTime</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SystemClock.html">SystemClock</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TunableClock.html">TunableClock</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ClockErrorDomain">ClockErrorDomain</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ClockTimelinesVersionNumber">ClockTimelinesVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ClockTimelinesVersionString">ClockTimelinesVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kAvailableKey">kAvailableKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kCorrelationKey">kCorrelationKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kSpeedKey">kSpeedKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kStartTicksKey">kStartTicksKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kTickRateKey">kTickRateKey</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/ClockError.html">ClockError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ClockProtocol.html">ClockProtocol</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Type Definitions.html">Type Definitions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Type Definitions/Correlation.html">Correlation</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/_correlation.html">_correlation</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <a href='#small-dvbcss-synckit-ios-small-br-clocktimelines-framework' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='small-dvbcss-synckit-ios-small-br-clocktimelines-framework'><small>dvbcss-synckit-ios</small><br/>ClockTimelines Framework</h1>

<ul>
<li><strong><a href="#overview">Overview</a></strong></li>
<li><strong><a href="#how-to-use">How to use</a></strong></li>
<li><strong><a href="#run-the-example-app">Run the example app</a></strong></li>
</ul>

<p>An implementation of software <q>clock</q> objects in Objective-C. Very similar to that done for <a href="https://github.com/bbc/pydvbcss">pydvbcss</a>.</p>

<p>This framework implements a generic and flexible model for thinking about clocks, timelines and the relationships between them. It defines software clock abstractions to model the passage of time e.g. system time, media timelines progress.
Software clocks can, for example, be used to simulate the system clock, a clock belonging to another device, or the timeline of a media.</p>

<ul>
<li><strong>SystemClock</strong> object represents local system clock time</li>
<li><strong>CorrelatedClock</strong> represents time calculated from a parent clock using a <em>correlation</em> relationship.</li>
<li><strong>TunableClock</strong> represents time calculated from a parent clock using an adjustable <em>offset</em> value.</li>
</ul>
<a href='#overview' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='overview'>Overview</h2>

<p>A clock object models time by calculating it based on some other source of time
represented by another clock object (its parent). They can be assembled into hierarchies
or chains. For example: suppose you have a presentation where a video clip is
to be played at a particular point. You describe the timing of that video clip in terms
of when it is to be played on the timeline of the overall presentation. Clock objects
can model this, with a clock representing the video clip time position, and its
parent representing the progress of the timeline of the overall presentation.</p>

<p>A software simulation of a clock still needs to rely on some kind of physical clock or timer to advance time along the timeline and correctly control its speed. In practice this means utilising system clocks provided by the hardware and operating system. So at the root of the hierarchy
or chain is a root clock that has no parent.</p>

<p>Three types of software clocks are provided:</p>
<a href='#a-href-http-bbc-github-io-dvbcss-synckit-ios-latest-clocktimelines-classes-systemclock-html-systemclock-a' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='a-href-http-bbc-github-io-dvbcss-synckit-ios-latest-clocktimelines-classes-systemclock-html-systemclock-a'><a href="../ClockTimelines/Classes/SystemClock.html">SystemClock</a></h4>

<p><em><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/ClockTimelines/ClockTimelines/SystemClock.h">ClockTimelines/SystemClock.h</a></em></p>

<p>A root clock class that is based on <code>MonotonicTime</code> as the underlying time source</p>
<a href='#a-href-http-bbc-github-io-dvbcss-synckit-ios-latest-clocktimelines-classes-correlatedclock-html-correlatedclock-a' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='a-href-http-bbc-github-io-dvbcss-synckit-ios-latest-clocktimelines-classes-correlatedclock-html-correlatedclock-a'><a href="../ClockTimelines/Classes/CorrelatedClock.html">CorrelatedClock</a></h4>

<p><em><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/ClockTimelines/ClockTimelines/CorrelatedClock.h">ClockTimelines/CorrelatedClock.h</a></em></p>

<p>A clock whose time is calculated form a parent clock by using a <em>correlation</em> and <em>speed</em>.
It also has a <em>tickRate</em> that sets the units of the clock. If the clock advances one second then the time it reports increases by the number of ticks dictated by its tick rate.</p>

<p>To model progress of a media timeline, or a clock on another device, we specify the relationship
with respect to a source of time e.g. the System Clock. This relationship is in the form of:</p>

<ul>
<li><p>A <strong>correlation</strong> <em>(parentTickValue, tickValue)</em> is a pair of numbers - a time value for the parent clock and the corresponding time for this clock.</p></li>
<li><p>The relative <strong>speed</strong> <em>s</em> is a number determining how rapidly this clock advances for every tick of the system clock.</p></li>
</ul>

<p>When the parent clock ticks property has the value <code>parentTickValue</code>, the ticks property of this clock shall have the value <code>tickValue</code>. For every second the parent clock advances, this
clock will advance by the same number of seconds multiplied by <code>s</code>.</p>
<a href='#a-href-http-bbc-github-io-dvbcss-synckit-ios-latest-clocktimelines-classes-correlatedclock-html-tunableclock-a' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='a-href-http-bbc-github-io-dvbcss-synckit-ios-latest-clocktimelines-classes-correlatedclock-html-tunableclock-a'><a href="../ClockTimelines/Classes/CorrelatedClock.html">TunableClock</a></h4>

<p><em><a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/ClockTimelines/ClockTimelines/CorrelatedClock.h">ClockTimelines/TunableClock.h</a></em></p>

<p>A clock that is related to a parent clock by using a <q>offset</q> instead of a <q>correlation</q>. In practice this is very similar to a CorrelatedClock.</p>
<a href='#reacting-to-changes' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='reacting-to-changes'>Reacting to changes</h3>

<p>Changes to properties of the clock objects are notified to observers using iOS&rsquo;s Key-Value-Observation (KVO) mechanism. To observe changes to a clock, an object must add itself as an observer using the <code>addObserver:</code> method.</p>

<p>In this way, your application can react to updates and changes without having
to continuously poll the clock objects.</p>
<a href='#how-to-use' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='how-to-use'>How to use</h2>
<a href='#1-add-the-framework-to-your-project' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='1-add-the-framework-to-your-project'>1. Add the framework to your project</h4>

<p>A Cocoa Pod version of this library is not currently available. To use this library, you must add it and its dependencies to your project.</p>

<p>Either include <em>ClockTimelines</em> in your workspace and build it; or build it in this repository&rsquo;s <a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/ClockTimelines/../synckit.xcworkspace">synckit.xcworkspace</a></p>

<p>Then add <em>ClockTimelines.framework</em> under <em>Linked Frameworks and libraries</em> in your project&rsquo;s target configuration.</p>
<a href='#2-import-the-header-files' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='2-import-the-header-files'>2. Import the header files</h4>
<pre class="highlight plaintext"><code>#import &lt;ClockTimelines/ClockTimelines.h&gt;
</code></pre>
<a href='#simple-example' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='simple-example'>Simple Example</h4>

<p>The SystemClock class uses a source of monotonic time to simulate system time. Monotonic time is provided by the <a href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/ClockTimelines/ClockTimelines/MonotonicTime.h">MonotonicTime</a> class.
Now we create a simple hierarchy with one clock at the root and another one based on it via a correlation:</p>
<pre class="highlight plaintext"><code>  SystemClock *sysCLK = [[SystemClock alloc] initWithTickRate:1000000];

  Correlation corel = [CorrelationFactory create:0 Correlation:500];

  CorrelatedClock *corelCLK = [[CorrelatedClock alloc] initWithParentClock:sysCLK TickRate:1000 Correlation:&amp;corel];

  NSLog(@"corelCLK ticks: %lld,  time: %f,  nanoseconds: %lld", [corelCLK ticks], [corelCLK time], [corelCLK nanoSeconds])

</code></pre>

<p><strong>Create a WallClock using a TunableClock object:</strong></p>
<pre class="highlight plaintext"><code>  SystemClock *sysCLK;
  sysCLK = [[SystemClock alloc] initWithTickRate:_kOneThousandMillion];

  //create a WallClock with start ticks equal to system clock current ticks and same tick rate as the system clock.
  TunableClock *wallClock = [[TunableClock alloc] initWithParentClock:sysCLK TickRate:_kOneThousandMillion Ticks:[sysCLK ticks]];

  NSLog(@"Wall clock time = %f ", [wallClock time]);
</code></pre>

<p><strong>Making changes to properties will trigger KVO notifications to observers.</strong>
This will generate 2 change events: one for the <code>speed</code> property and one for the <code>correlation</code> property):</p>
<pre class="highlight plaintext"><code>    wallClock.speed = 2.0

    MockDependent *observer; // a clock change observer

    //  create a system clock
    SystemClock *sysclock = [[SystemClock alloc] initWithTickRate:1000000];

    // Correlation Clock with correlation
    Correlation corel = [CorrelationFactory create:0 Correlation:500];
    CorrelatedClock *corelCLK = [[CorrelatedClock alloc] initWithParentClock:sysclock TickRate:1000 Correlation:&amp;corel];

    // an observer
    observer = [[MockDependent alloc] init];

    [corelCLK addObserver:observer context:nil];

    // change correlation relationship
    Correlation corel_new = [CorrelationFactory create:100 Correlation:5000];
    Correlation corel_old = corelCLK.correlation;

    // carry out actual change
    corelCLK.correlation = corel_new;

</code></pre>

<p><strong>To handle the key-value observations, an observer must implement the <code>observerValueForKeyPath:</code> method. For example,</strong></p>
<pre class="highlight plaintext"><code>@implementation MockDependent

- (id) init
{
    self = [super init];
    if (self != nil) {
        self.notifications = [[NSMutableArray alloc] init];
    }
    return self;
}

- (void) observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context
{
     if ([keyPath isEqualToString:@"tickRate"]) {
        NSLog(@"tickRate of clock object changed.");
        NSLog(@"%@", change);
    }

    if ([keyPath isEqualToString:@"speed"]) {
        NSLog(@"Speed of clock was changed.");
        NSLog(@"%@", change);
    }

    if ([keyPath isEqualToString:@"correlation"]) {
        NSLog(@"correlation was changed.");
    }

    if ([keyPath isEqualToString:@"startTicks"]) {
        NSLog(@"startTicks was changed.");
         NSLog(@"%@", change);
    }
}

@end

</code></pre>
<a href='#authors' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='authors'>Authors</h2>

<p>Rajiv Ramdhany (BBC R&amp;D)</p>
<a href='#licence' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='licence'>Licence</h2>

<p>This library is developed by BBC R&amp;D and distributed under the Apache License, <a href="http://www.apache.org/licenses/LICENSE-2.0">Version 2.0</a>.</p>

<p>© Copyright 2016 BBC R&amp;D. All Rights Reserved</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; British Broadcasting Corporation, under <a class="link" href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="external">Apache 2.0 open source licence</a></p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.7.2</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
